- function parseText(text) {
- 	text = escapeHtml(text);
- 	text = parseURL(text);
- 	text = parseReply(text);
- 	text = parseNewLine(text);
- 	return text;
- 	function parseURL(text) {
- 		return text.replace(/https?:\/\/[-_.!~*a-zA-Z0-9;\/?:\@&=+\$,%#]+/g,(url) => {
- 			return '<a href="' + url + '" target="_blank" class="url">' + url + '</a>';
- 		});
- 	}
- 	function parseReply(text) {
- 		return text.replace(/@([a-zA-Z0-9_]+)/g,(_, screenName) => {
- 			return '<a href="' + url + '/' + screenName + '" target="_blank" class="screenName">@' + screenName + '</a>';
- 		});
- 	}
- 	function parseNewLine(text) {
- 		return text.replace(/(\r\n|\r|\n)/g, '<br>');
- 	}
- }
- function escapeHtml(text) {
- 	return String(text)
- 		.replace(/&(?!\w+;)/g, '&amp;')
- 		.replace(/</g, '&lt;')
- 		.replace(/>/g, '&gt;')
- 		.replace(/"/g, '&quot;');
- }

div.timeline
	ol.posts
		each post in posts
			li.post(title!= '#{post.createdAt}&#x0A;via #{post.app.name}'
					style= post.isReply ? 'border-color: ' + post.reply.user.color + ';' : ''
					data-id= post.id
					data-userId= post.user.id)
				if post.isReply
					div.replyTo
						article
							a(href=url + '/' + post.reply.user.screenName)
								img.icon(src=url + '/img/icon/' + post.reply.user.screenName, alt='icon')
							header
								h2
									a(href=url + '/' + post.reply.user.screenName)= post.reply.user.name
								span.screenName= '@' + post.reply.user.screenName
								time(datetime=post.reply.createdAt)= post.reply.createdAt
							p.text!= (post.reply.isReply ? '<i class="fa fa-reply"></i>' : '') + parseText(post.reply.text)
							if post.reply.isImageAttached
								img.reply.image(src=url + '/img/post/' + post.reply.id, alt='image')
				article
					a(href=url + '/' + post.user.screenName)
						img.icon(src=url + '/img/icon/' + post.user.screenName, alt='icon')
					header
						h2
							a(href=url + '/' + post.user.screenName)= post.user.name
						span.screenName= '@' + post.user.screenName
						time(datetime=post.createdAt)= post.createdAt
					p.text!= (post.isReply ? '<i class="fa fa-reply"></i>' : '') + parseText(post.text)
					if post.isImageAttached
						img.image(src=url + '/img/post/' + post.id, alt='image')
				footer
					form.replyForm
						textarea(name='text')= '@' + post.user.screenName + ' '
						input(name='in_reply_to_post_id', type='hidden', value=post.id)
						input(type='submit', value='Reply')
						div.imageAttacher
							p
								i(class='fa fa-picture-o')
							input(name='image', type='file')